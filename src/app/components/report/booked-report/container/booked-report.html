@if(!printing){
    <div class="header">
        <h1>Booked Report</h1>
        <div style="display: flex; justify-content: flex-end; gap: 10px; align-items: center">
            <mat-form-field appearance="outline" floatLabel="always" subscriptSizing="dynamic">
                <mat-label>Date range</mat-label>
                <mat-date-range-input [formGroup]="dateRange" [rangePicker]="picker">
                    <input matStartDate required placeholder="Start date" formControlName="start">
                    <input matEndDate required placeholder="End date" formControlName="end">
                </mat-date-range-input>
                <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
                <mat-date-range-picker #picker></mat-date-range-picker>
                @if(dateRange.hasError('required')){
                    <mat-error>Please select a range</mat-error>
                }
            </mat-form-field>
            @if(!(loading$ | async)){
                <button mat-raised-button type="submit" (click)="searchResult()"
                    style="background-color: #ED2D89; color: white">
                    Search
                </button>
            } @else {
                <button mat-raised-button disabled style="background-color: gray; color: white">
                    <mat-icon>
                        <mat-spinner diameter="18"></mat-spinner>
                    </mat-icon>
                    Searching...
                </button>
            }
        </div>
    </div>
    @if(loading$ | async){
        <mat-progress-bar class="indeterminate"></mat-progress-bar>
    }
    <div class="body">
        @if(bookings$ | async; as bookings){
            @if(bookings.length > 0){
                <div style="display: flex; justify-content: flex-end; padding: 10px;">
                    <button mat-raised-button (click)="printReport()" style="background-color: #ED2D89; color: white">
                        <mat-icon>print</mat-icon>
                        Print Report
                    </button>
                </div>
                <table mat-table [dataSource]="bookings" class="mat-elevation-z8">

                    <ng-container matColumnDef="week">
                        <th mat-header-cell *matHeaderCellDef> Week # </th>
                        <td mat-cell *matCellDef="let booking"> {{ weekNumber(booking.departureDate) }} </td>
                    </ng-container>

                    <ng-container matColumnDef="pickupDate">
                        <th mat-header-cell *matHeaderCellDef> PU Date </th>
                        <td mat-cell *matCellDef="let booking"> {{ booking.pickupAt | date : 'EEE, MM/dd/yy' }} </td>
                    </ng-container>

                    <ng-container matColumnDef="lastName">
                        <th mat-header-cell *matHeaderCellDef> Last Name </th>
                        <td mat-cell *matCellDef="let booking"> {{ booking.customer?.primaryLastName || '' }} </td>
                    </ng-container>

                    <ng-container matColumnDef="recNo">
                        <th mat-header-cell *matHeaderCellDef> Rec No </th>
                        <td mat-cell *matCellDef="let booking"> {{ searchRecNo(booking) }} </td>
                    </ng-container>

                    <ng-container matColumnDef="car">
                        <th mat-header-cell *matHeaderCellDef> Car </th>
                        <td mat-cell *matCellDef="let booking"> {{ vehicleMake(booking.customer) }} </td>
                    </ng-container>

                    <ng-container matColumnDef="model">
                        <th mat-header-cell *matHeaderCellDef> Nodel </th>
                        <td mat-cell *matCellDef="let booking"> {{ vehicleModel(booking.customer) }} </td>
                    </ng-container>

                    <ng-container matColumnDef="origin">
                        <th mat-header-cell *matHeaderCellDef> Origin </th>
                        <td mat-cell *matCellDef="let booking"> {{ booking.pickupAddress.city }} </td>
                    </ng-container>

                    <ng-container matColumnDef="destination">
                        <th mat-header-cell *matHeaderCellDef> Destination </th>
                        <td mat-cell *matCellDef="let booking"> {{ booking.arrivalAddress.city }} </td>
                    </ng-container>

                    <ng-container matColumnDef="date">
                        <th mat-header-cell *matHeaderCellDef> Arrival Date </th>
                        <td mat-cell *matCellDef="let booking"> {{ booking.arrivalAt | date : 'EEE, MM/dd/yy' }} </td>
                    </ng-container>

                    <tr mat-header-row *matHeaderRowDef="['week', 'pickupDate','lastName', 'recNo', 'car', 'model', 'origin', 'destination', 'date']"></tr>
                    <tr mat-row *matRowDef="let booking; columns: ['week', 'pickupDate', 'lastName', 'recNo', 'car', 'model', 'origin', 'destination', 'date'];"></tr>

                </table>
            } @else {
                <div style="display: felx; justify-content: center; text-align: center">
                    <p>No bookings found.</p>
                </div>
            }
            
        } @else {
            <div style="display: felx; justify-content: center; text-align: center">
                <p>Select date range.</p>
            </div>
        }
    </div>
} @else {
    @if(dateRange.controls.start.value && dateRange.controls.end.value){
        <app-print-view-booked-report
            [bookings]="(bookings$ | async) || []"
            [startDate]="dateRange.controls.start.value"
            [endDate]="dateRange.controls.end.value"
        >
        </app-print-view-booked-report>
    }   
}
