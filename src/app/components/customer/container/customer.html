    <div class="headers">
        <h1>Customers</h1>
        <button mat-button mat-raised-button (click)="addCustomer()" style="background-color: #ED2D89; color: white">
            Add Customer
        </button>
    </div>
    <div class="search">
        <mat-form-field appearance="outline" subscriptSizing="dynamic" [class.form-field]="!(isMobile$ | async)"
            [class.form-field-mobile]="isMobile$ | async">
            <input type="text" matInput [formControl]="searchCustomer"
                [placeholder]="!(isMobile$ | async) ? 'Search by Rec No, Last Name or Phone Number' : 'Search customer'"
                (keyup.enter)="onSearch()">
            <button mat-icon-button matSuffix class="search-button" color="primary" (click)="onSearch()">
                <mat-icon>search</mat-icon>
            </button>
        </mat-form-field>

    </div>
    @if(loading$ | async){
        <mat-progress-bar mode="indeterminate"></mat-progress-bar>
    }
    <div class="body">
        <mat-card *ngFor="let record of records" [class.record-card-desktop]="!(isMobile$ | async)"
            [class.record-card-mobile]="isMobile$ | async">
            <mat-card-header>
                <div mat-card-avatar style="text-align: center; margin: 0px">
                    <h2 style="margin: 0px; color: white">{{ record.recNo }}</h2>
                </div>
            </mat-card-header>

            <mat-card-content>
                <div class="customer-info">
                    <mat-card-title>{{ record.customer.primaryTitle }} {{ record.customer.primaryLastName }}, {{
                        record.customer.primaryFirstName
                        }}
                        {{ record.customer.primaryMiddleName }}</mat-card-title>
                    @if(record.customer.secondaryFirstName){
                        <mat-card-subtitle>
                            {{ record.customer.secondaryTitle }} {{ record.customer.secondaryLastName }}, {{
                            record.customer.secondaryFirstName }} {{
                            record.customer.secondaryMiddleName }}
                        </mat-card-subtitle>
                    }
                    <div style="display: block">
                        <section class="info-section">
                            <h4>Contact Information</h4>
                            <div style="margin-left: 20px">
                                <p>
                                    <mat-icon>email</mat-icon>
                                    @if(record.customer.email){
                                        <a [href]="'mailto:' + record.customer.email">{{
                                            record.customer.email }}</a>
                                    } @else {
                                        <span style="color: darkgray;">No provided</span>
                                    }
                                </p>
                                <p>
                                    <mat-icon>phone</mat-icon>
                                    @if(record.customer.primaryPhone){
                                        <a [href]="'tel:' + record.customer.primaryPhone">{{
                                            record.customer.primaryPhone }}</a>
                                    } @else {
                                        <span style="color: darkgray;">No provided</span>
                                    }
                                </p>
                                @if(record.customer.secondaryPhone){
                                    <p>
                                        <mat-icon>phone</mat-icon>
                                        <a [href]="'tel:' + record.customer.secondaryPhone">{{
                                            record.customer.secondaryPhone }}</a>
                                    </p>
                                }
                            </div>
                        </section>
                        <section class="info-section">
                            <h4>Vehicle</h4>
                            <div style="margin-left: 20px;">
                                @if(record.vehicle){
                                    <p><strong>Make:</strong> {{ record.vehicle.make }}</p>
                                    <p><strong>Model:</strong> {{ record.vehicle.model }}</p>
                                    <p><strong>Year:</strong> {{ record.vehicle.year }}</p>
                                    <p><strong>Plate:</strong> {{ record.vehicle.plate }}</p>
                                    <p><strong>State:</strong> {{ record.vehicle.state }}</p>
                                } @else {
                                    <p style="color: darkgray;">No provided</p>
                                }
                            </div>
                        </section>
                        <section class="info-section">
                            <h4>Florida Address</h4>
                            @if(record.customer.floridaAddress){
                                <div style="margin-left: 20px;">
                                    <p>{{ record.customer.floridaAddress.address1 }} {{
                                        record.customer.floridaAddress.address2 }}</p>
                                    <p> {{record.customer.floridaAddress.city }}, {{ record.customer.floridaAddress.state }}
                                        {{ record.customer.floridaAddress.zipCode }}</p>
                                </div>
                            } @else {
                                <p style="color: darkgray; margin-left: 20px;">No provided</p>
                            }
                            
                        </section>
                        <section class="info-section">
                            <h4>New York Address</h4>
                            @if(record.customer.newYorkAddress){
                                <div style="margin-left: 20px;">
                                    <p>{{ record.customer.newYorkAddress.address1 }} {{
                                        record.customer.newYorkAddress.address2 }}</p>
                                    <p> {{record.customer.newYorkAddress.city }}, {{ record.customer.newYorkAddress.state }}
                                        {{ record.customer.newYorkAddress.zipCode }}</p>
                                </div>
                            } @else {
                                <p style="color: darkgray; margin-left: 20px;">No provided</p>
                            }
                        </section>

                    </div>
                    <mat-card-actions>
                        <button mat-button color="warn" (click)="createBooking(record.customer)" matTooltip="New booking">Book</button>
                        <button mat-button color="primary" (click)="toEditCustomer(record.customer)" matTooltip="Edit customer">Edit</button>
                        <button mat-button style="color: red;" (click)="deleteRecord(record)" matTooltip="Delete record">Delete</button>
                    </mat-card-actions>
                </div>
                <div style="border-radius: 5px; width: 77%">
                    <div style=" margin: 10px 0px 10px 0px; padding: 2px;">
                        <h3 style="text-align: center; margin: 0px;">Bookings</h3>
                    </div>
                    @if(record.bookings && record.bookings.length > 0){
                        <table style="border: 2px solid darkgray;" mat-table [dataSource]="record.bookings" class="mat-elevation-z8">
                            <ng-container matColumnDef="season">
                                <th mat-header-cell *matHeaderCellDef> Season </th>
                                <td [class.currentSeason]="isCurrentSeason(booking.season)" mat-cell *matCellDef="let booking">
                                    {{booking.season}} </td>
                            </ng-container>

                            <ng-container matColumnDef="departureDate">
                                <th mat-header-cell *matHeaderCellDef> Departure Date </th>
                                <td mat-cell *matCellDef="let booking"> {{booking.departureDate | date : 'EEE MMM dd, yyyy'}}
                                </td>
                            </ng-container>

                            <ng-container matColumnDef="from">
                                <th mat-header-cell *matHeaderCellDef> From </th>
                                <td mat-cell *matCellDef="let booking"> {{booking.from}} </td>
                            </ng-container>

                            <ng-container matColumnDef="to">
                                <th mat-header-cell *matHeaderCellDef> To </th>
                                <td mat-cell *matCellDef="let booking"> {{booking.to}} </td>
                            </ng-container>

                            <ng-container matColumnDef="paymentType">
                                <th mat-header-cell *matHeaderCellDef> Payment Type </th>
                                <td mat-cell *matCellDef="let booking"> {{booking.paycheck.checkNumber}} </td>
                            </ng-container>

                            <ng-container matColumnDef="bank">
                                <th mat-header-cell *matHeaderCellDef> Bank </th>
                                <td mat-cell *matCellDef="let booking"> {{booking.paycheck.bankName}} </td>
                            </ng-container>

                            <ng-container matColumnDef="amount">
                                <th mat-header-cell *matHeaderCellDef> Amount </th>
                                <td mat-cell *matCellDef="let booking"> {{booking.paycheck.amount}} </td>
                            </ng-container>

                            <ng-container matColumnDef="notes">
                                <th mat-header-cell *matHeaderCellDef> Notes </th>
                                <td mat-cell *matCellDef="let booking"> {{booking.notes}} </td>
                            </ng-container>

                            <ng-container matColumnDef="actions">
                                <th mat-header-cell *matHeaderCellDef></th>
                                <td mat-cell *matCellDef="let booking" style="display: flex; justify-content: space-evenly; padding: 10px 5px">
                                    @if(editableBooking(booking)){
                                        <button mat-raised-button color="primary" (click)="editBooking(booking, record.customer)">Edit</button>
                                    } @else {
                                        <button mat-raised-button color="primary" (click)="viewBooking(booking)">View</button>
                                    }
                                    @if((deletingBooking$ | async) === booking.id){
                                        <button mat-raised-button disabled style="color: red;">
                                            <mat-icon>
                                                <mat-spinner diameter="18"></mat-spinner>
                                            </mat-icon>
                                            Deleting...
                                        </button>
                                    } @else {
                                        <button mat-raised-button style="color: red;" (click)="deleteBooking(booking)">Delete</button>
                                    }
                                </td>
                            </ng-container>

                            <tr style="background-color: #2664b4; color: white; text-align: center; border-top-left-radius: 10px; border-top-right-radius: 10px; height: 30px;"
                                mat-header-row *matHeaderRowDef="bookingColumns"></tr>
                            <tr mat-row *matRowDef="let row; columns: bookingColumns;"></tr>
                        </table>
                    } @else {
                        <div style="text-align: center; border: 2px solid darkgray">
                            <h4 style="color: darkgray;">No bookings found.</h4>
                        </div>
                    }
                </div>
            </mat-card-content>
        </mat-card>
        @if(!(customerList$ | async) || (customerList$ | async)?.length === 0){
            <div style="text-align: center; margin-top: 20px">
                <h2>No customers found.</h2>
            </div>
        }
    </div>

    <mat-paginator class="pagination" [length]="totalPagination$ | async" [pageSize]="searchCriteria.pageSize"
        aria-label="Select page" (page)="onPageChange($event)">
    </mat-paginator>